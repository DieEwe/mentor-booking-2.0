<!-- src/routes/+layout.svelte -->
<script lang="ts">
	// Import global Tailwind & Flowbite
	import '$lib/../app.css';
	import {logout} from '$lib/stores';
	import { currentUser } from '$lib/stores';
	import { get } from 'svelte/store';

	let isSidebarOpen = false;   // Tracks sidebar visibility on small screens

	// Reactive assignment of user data
	$: user = $currentUser;
	$: userRole = user ? user.role : 'guest';
	$: console.log("Aktuelle UserRole:", userRole); //log the current userRole
	$: canEdit = userRole === 'admin' || userRole === 'coach';

	function toggleSidebar() {
		isSidebarOpen = !isSidebarOpen;
	}
</script>

<!-- Container for entire viewport -->
<div class="flex flex-col h-screen">

	<!-- MOBILE NAVBAR / HEADER (visible on small screens only) -->
	<header class="md:hidden bg-blue-600 p-4 flex items-center justify-between">
		<!-- Title or brand -->
		<!-- <h1 class="text-white font-bold text-lg">My Web App</h1> -->

		<!-- Hamburger button -->
		<button
			on:click={toggleSidebar}
			aria-label="Toggle Sidebar"
			class="p-2 text-white rounded hover:bg-blue-700 focus:outline-none focus:ring"
		>
			<!-- A simple icon (Hamburger) -->
			<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
			     xmlns="http://www.w3.org/2000/svg">
			  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
			        d="M4 6h16M4 12h16M4 18h16"></path>
			</svg>
		</button>
	</header>

	<!-- Main content area is a flex container -->
	<div class="flex flex-1 relative">
		<!-- BACKDROP OVERLAY on small screens when sidebar is open -->
		{#if isSidebarOpen}
		<button
		  type="button"
		  on:click={toggleSidebar}
		  class="fixed inset-0 bg-black/50 z-10 md:hidden 
				 cursor-pointer focus:outline-none"
		  aria-label="Close sidebar backdrop"
		>
		  <!-- 
			You don't need text here. The button itself 
			is an overlay, purely for clicking. 
		  -->
		</button>
	  {/if}
	  

		<!-- SIDEBAR (off-canvas on mobile, static on desktop) -->
		<aside
			class="
				fixed top-0 left-0 h-full w-64 bg-white dark:bg-gray-800 border-r
				transform transition-transform duration-300 z-20
				md:translate-x-0
				{isSidebarOpen ? 'translate-x-0' : '-translate-x-full'}
				md:relative md:inset-0
			"
			aria-label="Sidebar"
		>
			<div class="overflow-y-auto py-4 px-3 h-full dark:bg-gray-800 flex flex-col">
				<!-- (Optional) Another logo/title for desktop -->
				<!-- If you want it hidden on mobile, you can do: `hidden md:flex` etc. -->
				<div class="mb-5 flex items-center md:flex items-center pl-2.5">
					<svg
					class="w-12 h-12 md:w-16 md:h-16"
					width="50px"
					height="50px"
					viewBox="0 0 200 199.99999"
					version="1.1"
					id="svg1"
					xml:space="preserve"
					xmlns="http://www.w3.org/2000/svg"
					><defs
					id="defs1" /><g
					id="layer1"
					style="display:none"><path
					style="display:inline;fill:#0b2208;fill-opacity:1;stroke-width:0.396392"
					d="m 115.31415,39.695222 c 0,0 3.23615,1.11172 4.91629,1.11172 1.68017,0 3.36265,-0.47218 4.91632,-1.11172 4.57182,-1.8819 5.39038,-7.86098 12.57757,-7.86098 7.18719,0 17.21591,6.75164 16.54212,18.88003 -0.67382,12.12839 -5.98595,18.62815 -15.4191,19.52653 -9.4332,0.8984 -8.39766,-6.71532 -13.29734,-8.75313 -1.54681,-0.64334 -3.24484,-0.98072 -4.9194,-1.02864 -1.79125,-0.0512 -5.31642,0.79777 -5.31642,0.79777"
					id="path7" /><rect
					style="fill:#151515;fill-opacity:1;stroke:none;stroke-width:1.83282"
					id="rect1"
					width="100.41418"
					height="100.41418"
					x="26.547298"
					y="126.22803" /></g><path
					id="path7-3"
					style="display:inline;fill:#39b2c1;fill-opacity:1;stroke-width:0.396392"
					d="M 22.883357,0 C 10.205953,0 0,10.205953 0,22.883357 v 50.127171 c 0,6.338703 2.5514883,12.059542 6.687652,16.195705 4.136164,4.136164 9.857003,6.687652 16.195705,6.687652 0,0 5.032567,0.332367 1.538001,-5.793067 -2.326428,-4.077868 -2.086806,-9.528594 -1.178493,-13.11385 1.030246,-4.066551 7.206944,-18.251516 24.704594,-18.03863 17.5136,0.21308 24.455711,13.273198 25.581901,20.564635 0.557837,3.611675 0.136319,7.64744 -1.648405,10.838874 -1.552498,2.776167 -2.315528,5.423523 1.129573,5.542038 12.66991,0.435857 22.883357,-10.205952 22.883357,-22.883357 0,0 -1.083929,-14.472791 5.316475,-15.678629 1.67456,0.04792 3.37227,0.385021 4.91908,1.028361 4.89968,2.03781 3.86417,9.651871 13.29737,8.753471 9.43315,-0.89838 14.7454,-7.398584 15.41922,-19.526973 0.67379,-12.12839 -9.35495,-18.879984 -16.54214,-18.879984 -7.18719,0 -8.00571,5.979119 -12.57753,7.861019 -1.55367,0.63954 -3.29337,1.546138 -4.9165,1.112076 C 94.855792,36.08762 95.893885,22.883357 95.893885,22.883357 95.893885,10.205953 85.687933,0 73.010528,0 Z" /><path
					id="path7-3-2"
					style="display:inline;fill:#f84d42;fill-opacity:1;stroke-width:0.396392"
					d="M 199.99999,22.883357 C 199.99999,10.205953 189.79404,0 177.11663,0 h -50.12717 c -6.3387,0 -12.05954,2.551488 -16.1957,6.687652 -4.13616,4.136164 -6.68765,9.857003 -6.68765,16.195705 0,0 -0.33237,5.032567 5.79306,1.538001 4.07787,-2.326428 9.5286,-2.086806 13.11385,-1.178493 4.06655,1.030246 18.25152,7.206944 18.03863,24.704594 -0.21308,17.5136 -13.27319,24.455711 -20.56463,25.581901 -3.61168,0.557837 -7.64744,0.136319 -10.83888,-1.648405 -2.77616,-1.552498 -5.42352,-2.315528 -5.54203,1.129573 -0.43586,12.66991 10.20595,22.883352 22.88335,22.883352 0,0 14.47279,-1.08392 15.67863,5.31648 -0.0479,1.67456 -0.38502,3.37227 -1.02836,4.91908 -2.03781,4.89968 -9.65187,3.86417 -8.75347,13.29737 0.89838,9.43315 7.39859,14.7454 19.52697,15.41922 12.12839,0.67379 18.87999,-9.35495 18.87999,-16.54214 0,-7.18719 -5.97912,-8.00571 -7.86102,-12.57753 -0.63954,-1.55367 -1.54614,-3.29337 -1.11208,-4.9165 1.59225,-5.95407 14.79651,-4.91598 14.79651,-4.91598 12.67741,0 22.88336,-10.205947 22.88336,-22.883352 z" /><path
					id="path7-3-2-5"
					style="display:inline;fill:#fbc12c;fill-opacity:1;stroke-width:0.396392"
					d="m 177.11664,199.99999 c 12.6774,0 22.88335,-10.20595 22.88335,-22.88336 v -50.12717 c 0,-6.3387 -2.55148,-12.05954 -6.68765,-16.1957 -4.13616,-4.13616 -9.857,-6.68765 -16.1957,-6.68765 0,0 -5.03257,-0.33237 -1.538,5.79306 2.32642,4.07787 2.0868,9.5286 1.17849,13.11385 -1.03025,4.06655 -7.20694,18.25152 -24.70459,18.03863 -17.5136,-0.21308 -24.45572,-13.27319 -25.58191,-20.56463 -0.55783,-3.61168 -0.13631,-7.64744 1.64841,-10.83888 1.5525,-2.77616 2.31553,-5.42352 -1.12957,-5.54203 -12.66992,-0.43586 -22.88336,10.20595 -22.88336,22.88335 0,0 1.08392,14.47279 -5.316477,15.67863 -1.67456,-0.0479 -3.37227,-0.38502 -4.91908,-1.02836 -4.89968,-2.03781 -3.86417,-9.65187 -13.29737,-8.75347 -9.43315,0.89838 -14.7454,7.39859 -15.41922,19.52697 -0.67379,12.12839 9.35495,18.87999 16.54214,18.87999 7.18719,0 8.00571,-5.97912 12.57753,-7.86102 1.55367,-0.63954 3.29337,-1.54614 4.9165,-1.11208 5.954067,1.59225 4.915977,14.79651 4.915977,14.79651 0,12.67741 10.20595,22.88336 22.88336,22.88336 z" /><path
					id="path7-3-3"
					style="display:inline;fill:#fba82b;fill-opacity:1;stroke-width:0.396392"
					d="m 0,177.11664 c 0,12.6774 10.205953,22.88335 22.883357,22.88335 h 50.127171 c 6.338703,0 12.059542,-2.55148 16.195705,-6.68765 4.136164,-4.13616 6.687652,-9.857 6.687652,-16.1957 0,0 0.332367,-5.03257 -5.793067,-1.538 -4.077868,2.32642 -9.528594,2.0868 -13.11385,1.17849 -4.066551,-1.03025 -18.251516,-7.20695 -18.03863,-24.7046 0.21308,-17.5136 13.273198,-24.45571 20.564635,-25.5819 3.611675,-0.55783 7.64744,-0.13632 10.838874,1.64841 2.776167,1.5525 5.423523,2.31553 5.542038,-1.12957 0.435857,-12.66991 -10.205952,-22.88336 -22.883357,-22.88336 0,0 -14.472791,1.08393 -15.678629,-5.316477 0.04792,-1.67456 0.385021,-3.37227 1.028361,-4.91908 2.03781,-4.89968 9.651871,-3.86417 8.753471,-13.29737 -0.89838,-9.433149 -7.398584,-14.745399 -19.526973,-15.419219 -12.12839,-0.67379 -18.879984,9.35495 -18.879984,16.542139 0,7.18719 5.979119,8.00571 7.861019,12.57753 0.63954,1.55367 1.546138,3.29337 1.112076,4.9165 C 36.08762,105.1442 22.883357,104.10611 22.883357,104.10611 10.205953,104.10611 0,114.31206 0,126.98947 Z" /><path
					style="display:none;fill:#0b2208;fill-opacity:1;stroke-width:0.396392"
					d="m 121.4803,120.78198 c 0,0 1.11172,-3.23615 1.11172,-4.9163 0,-1.68016 -0.47218,-3.36265 -1.11172,-4.91632 -1.8819,-4.57182 -7.86098,-5.39038 -7.86098,-12.577565 0,-7.18719 6.75164,-17.215909 18.88003,-16.542119 12.12839,0.673821 18.62815,5.98595 19.52653,15.4191 0.8984,9.433204 -6.71532,8.397664 -8.75313,13.297334 -0.64334,1.54682 -0.98072,3.24485 -1.02864,4.91941 -0.0512,1.79124 0.79777,5.31642 0.79777,5.31642"
					id="path4-0" /><rect
					style="display:none;fill:#151515;fill-opacity:1;stroke:none;stroke-width:1.83282"
					id="rect1-9"
					width="100.41418"
					height="100.41418"
					x="116.65778"
					y="43.860874" /><path
					id="path1-6"
					style="display:none;fill:#3380cf;fill-opacity:1;stroke-width:0.389961"
					d="m 134.76539,46.749214 c 0.0173,-11.23722 -9.45521,-17.470856 -16.30484,-17.470856 -7.07059,0 -7.87648,5.882522 -12.37414,7.733896 -1.52846,0.629167 -3.18332,1.093573 -4.83623,1.093573 -1.652875,0 -4.836217,-1.093573 -4.836217,-1.093573 0,0 0.832975,-25.914297 -0.398754,-30.8675164 C 94.969604,1.9399907 91.721614,-0.04210302 88.481187,0 86.800408,0.02183844 32.917115,0.02183844 11.217012,0.01637883 4.0695176,0.01458057 0,5.7137802 0,9.6816524 V 89.469681 c 0,0 1.3733662,8.370919 9.1508365,8.334559 3.8887345,-0.01818 9.3784955,-0.102264 13.8984135,-0.313608 8.717974,-0.01855 7.820466,-3.949762 3.676414,-7.374686 -2.560185,-2.11591 -4.118217,-6.05157 -3.432178,-12.125995 0.892865,-7.905733 7.318091,-19.572634 24.118624,-19.368235 16.815847,0.20459 23.318716,9.303135 24.563191,19.745328 0.62224,5.221122 -1.246263,9.491621 -3.491037,11.60491 -2.835271,2.669199 -7.663929,7.586967 3.719587,8.242554 5.644597,0.276964 12.697281,0.169168 17.111011,-0.09765 8.827459,-0.533643 7.497856,-9.898943 7.497856,-9.898943 l -0.398755,-29.99413 c 0,0 3.468002,-0.834861 5.230187,-0.784454 1.64739,0.04716 3.31749,0.378795 4.8392,1.011704 4.8202,2.004747 3.80103,9.49496 13.08119,8.611134 9.28012,-0.883808 14.50621,-7.277827 15.1691,-19.209456 0.0206,-0.372864 0.0311,-0.741005 0.0318,-1.103496 z" /><path
					id="path1-6-1"
					style="display:none;fill:#44cf33;fill-opacity:1;stroke-width:0.389961"
					d="m 134.76539,46.749871 c 0.0173,-11.23722 -9.45521,-17.470856 -16.30484,-17.470856 -7.07059,0 -7.87648,5.882522 -12.37414,7.733896 -1.52846,0.629167 -3.18332,1.093573 -4.83623,1.093573 -1.65288,0 -4.836217,-1.093573 -4.836217,-1.093573 0,0 0.832975,-25.914297 -0.398754,-30.8675164 C 94.969604,1.9406476 91.721614,-0.04144642 88.481187,6.565791e-4 86.800408,0.02249658 32.917115,0.02249658 11.217012,0.01703658 4.0695176,0.01523658 0,5.7144376 0,9.6823096 V 89.470341 c 0,0 1.3733662,8.37092 9.1508365,8.33456 3.8887345,-0.0182 9.3784955,-0.10227 13.8984135,-0.31361 8.717974,-0.0186 7.820466,-3.94976 3.676414,-7.37469 -2.560185,-2.11591 -4.118217,-6.05157 -3.432178,-12.12599 0.892865,-7.905735 7.318091,-19.572636 24.118624,-19.368237 16.815847,0.20459 23.318716,9.303135 24.563191,19.745327 0.62224,5.22112 -1.246263,9.49162 -3.491037,11.60491 -2.835271,2.6692 -7.663929,7.58697 3.719587,8.24255 5.644597,0.27697 12.697281,0.16917 17.111011,-0.0977 8.827459,-0.53364 7.497856,-9.89894 7.497856,-9.89894 L 96.413963,58.224442 c 0,0 3.467997,-0.834861 5.230187,-0.784454 1.64739,0.04716 3.31749,0.378795 4.8392,1.011704 4.8202,2.004747 3.80103,9.49496 13.08119,8.611134 9.28012,-0.883808 14.50621,-7.277827 15.1691,-19.209456 0.0206,-0.372864 0.0311,-0.741005 0.0318,-1.103496 z" /></svg>
							<span class="self-center text-lg md:text-xl font-semibold whitespace-nowrap dark:text-white">
								<!-- My Web App -->
							</span>
				</div>

				<!-- NAVIGATION LINKS -->
				<ul class="space-y-2 flex-1">

					<!-- Landing link -->
					<li>
						<a
							href="/"
							class="flex items-center p-2 text-base font-normal text-gray-900 
                                rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700"
						>
							<span class="ml-3">Home</span>
						</a>
					</li>

				
					<!-- Login link -->
					{#if userRole === 'guest'}
					<li>
						<a
							href="/login"
							class="flex items-center p-2 text-base font-normal text-gray-900 
                                rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700"
						>
							<span class="ml-3">Login</span>
						</a>
					</li>
					<!-- Show "Apply as Mentor" if user is a guest -->
					{#if userRole === 'guest'}
					<li>
						<a
							href="/apply-as-mentor"
							class="flex items-center p-2 text-base font-normal text-gray-900 
							rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700"
						>
							<span class="ml-3">Bewerbung als MentorIn</span>
						</a>
					</li>
					{/if}
					<!-- Show only for mentors, coaches, admins -->
					{:else if userRole === 'mentor' || userRole === 'coach' || userRole === 'admin'}
						<li>
							<a
								href="/alle-coaching-termine"
								class="flex items-center p-2 text-base font-normal text-gray-900 
                                  rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700"
							>
								<span class="ml-3">Alle Coaching Termine</span>
							</a>
						</li>
						<li>
							<a
								href="/mein-profil"
								class="flex items-center p-2 text-base font-normal text-gray-900 
                                  rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700"
							>
								<span class="ml-3">Mein Profil</span>
							</a>
						</li>
						<li>
							<button
							type="button"
							on:click={logout}
							class="text-white bg-third hover:third-hover 
								   font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mt-4"
						  >
							ausloggen
						  </button>
						</li>
					{/if}
				</ul>
			</div>
		</aside>

		<!-- MAIN CONTENT: offset by w-64 on md+ devices -->
		<main class="flex-1 ml-0 md:ml-16 p-4 sm:p-6 lg:p-8 overflow-auto">
			<slot />
		</main>
	</div>
</div>
